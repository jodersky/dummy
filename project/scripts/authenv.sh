#!/bin/sh

# Set up the environment for signing and publishing sbt projects.
# WARNING: this script has global side effects, it is intended to be
# run in an isolated, throw-away environment!

set -e

# import public key from key servers
gpg2 --batch --keyserver hkp://pool.sks-keyservers.net --recv-keys 4E7DA7B5A0F86992D6EB3F514601878662E33372

# import secret signing sub key
#
# this block contains only an encrypted secret subkey used for signing
gpg2 --batch --passphrase="$GPG_PASSPHRASE" --import <<EOF
-----BEGIN PGP PRIVATE KEY BLOCK-----
Version: GnuPG v2

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
6r9amPXdEapW7TOk
=QVvk
-----END PGP PRIVATE KEY BLOCK-----
EOF

# prepare gpg settings for sbt
cat << EOF > gpg.sbt
import com.typesafe.sbt.pgp.PgpKeys._
pgpSigningKey in Global := Some(0x2CED17AB2B6D6F37l)
pgpPassphrase in Global := Some(sys.env("GPG_PASSPHRASE").toArray)
useGpg in Global := true
EOF

# prepare bintray settings
mkdir -p "$HOME"/.bintray
cat << EOF > "$HOME"/.bintray/.credentials
realm = Bintray API Realm
host = api.bintray.com
user = jodersky
password = "$BINTRAY_KEY"
EOF
